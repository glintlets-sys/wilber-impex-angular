<section class="upper mt-5 mb-5">
  <div class="container">
    <div class="col-lg-5 col-md-8 mx-auto">
      <div class="card shadow border-0">
        <div class="card-body px-lg-5 py-lg-5">
          <h4 class="card-title font-weight-bold text-center mb-4">
            Login or Register
          </h4>
          <!-- Step 1: Mobile Number Entry -->
          <ng-container *ngIf="!otpRequested">
            <div class="text-center text-muted mb-4 text-light">
              <small>Enter your 10 digit mobile number</small>
            </div>
            <form role="form">
              <div class="form-group" [ngClass]="{ 'focused': focus === true }">
                <div class="input-group input-group-alternative mb-3">
                  <span class="input-group-text">
                    <i class="ni ni-mobile-button"></i>+91
                  </span>
                  <input class="form-control" placeholder="Mobile Number" type="tel" pattern="[0-9]*"
                    inputmode="numeric" maxlength="10" [(ngModel)]="authDetails.mobileNumber" autocomplete="off"
                    (keydown.enter)="checkUserExistence()" required>

                </div>
              </div>
              <div class="text-center">
                <button class="btn btn-custom my-4 mx-1" (click)="checkUserExistence()" type="button">
                  Next
                </button>
              </div>
            </form>
          </ng-container>

          <!-- Step 2: OTP Entry and Registration -->
          <ng-container *ngIf="otpRequested">
            <form role="form">
              <ng-container>
                <section>
                  <div class="form-group mb-3" *ngIf="!userAlreadyRegistered">
                    <div class="input-group input-group-alternative">
                      <input type="text" class="form-control" placeholder="Enter User Name" autocomplete="off"
                        [(ngModel)]="userName">
                    </div>
                  </div>
                  <div class="form-group mb-3">
                    <div class="input-group input-group-alternative">
                      <input class="form-control" placeholder="4-Digit Pin" pattern="[0-9]*" autocomplete="off"
                        type="password" inputmode="numeric" maxlength="4" [(ngModel)]="authDetails.authPin"
                        (keydown.enter)="userLogin()">
                    </div>
                  </div>
                </section>
              </ng-container>

              <!-- Conditionally render the login button if the user is already registered -->
              <ng-container>
                <div class="text-center">
                  <button class="btn btn-custom-login my-2 mx-1" (click)="userLogin()" type="button">Login</button>
                  <br />
                  <button class="btn btn-link m-1" (click)="switchToLogin()" type="button">Back to Login</button>
                </div>
              </ng-container>

              <!-- Request OTP Section -->
              <section>
                <div class="text-center">
                  <ng-container *ngIf="(smsService.countdown$ | async) > 0">
                    <p class="">
                      {{ "Not received your code? " + (smsService.countdown$ | async) + " Secs" }}
                    </p>
                  </ng-container>
                  <button class="btn btn-outline-secondary my-2" (click)="requestOTP()"
                    [disabled]="(smsService.countdown$ | async) > 0" type="button">
                    Resend OTP
                  </button>
                </div>
              </section>

            </form>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="modal-header">
  <h3 class="panel-title mb-0 p-0">
    <span *ngIf="!editUser">Add Admin User</span>
    <span *ngIf="editUser">Edit User Role</span>
  </h3>
  <button type="button" class="btn-close btn btn-primary btn-with-icon" (click)="onCancel()">
    <i class="fas fa-times"></i>
  </button>
</div>

<div class="modal-body">
  <section>
    <div class="container">
      <form>
        <!-- User Selection (Only for Add Mode) -->
        <div class="col-md-12 mb-3" *ngIf="!editUser">
          <div class="form-group row clearfix">
            <div class="col-md-3">
              <label for="user" class="control-label">Select User:</label>
            </div>
            <div class="col-sm-8">
              <select name="user" 
                      class="form-control" 
                      [(ngModel)]="selectedUser.id"
                      (change)="changeUser($event)">
                <option value="">-- Select a User --</option>
                <option *ngFor="let user of allUsers" [value]="user?.id">
                  {{ user?.name }} ({{ user?.username }})
                </option>
              </select>
              <div *ngIf="isLoading" class="mt-2">
                <small class="text-muted">
                  <i class="fas fa-spinner fa-spin"></i> Loading users...
                </small>
              </div>
            </div>
          </div>
        </div>

                 <!-- Role Selection -->
         <div class="col-md-12 mb-3">
           <div class="form-group row clearfix">
             <div class="col-md-3">
               <label for="role" class="control-label">
                 {{ editUser ? 'Change Role:' : 'Select Role:' }}
               </label>
             </div>
             <div class="col-sm-8">
               <select name="role" 
                       class="form-control" 
                       [(ngModel)]="selectedUser.role.role_name">
                 <option value="">-- Select a Role --</option>
                 <option *ngFor="let role of userRoles" [value]="role.role">
                   {{ role.displayName || role.role }}
                 </option>
               </select>
               <small *ngIf="editUser" class="form-text text-muted">
                 Current role: <strong>{{ editUser.role }}</strong>
               </small>
               
               <!-- Role Help Text -->
               <div class="mt-2">
                 <small class="text-muted">
                   <i class="fas fa-info-circle me-1"></i>
                   <strong>Quick Guide:</strong>
                 </small>
                 <div class="mt-1">
                   <small class="text-muted">
                     • <strong>Super Admin:</strong> Full system access<br>
                     • <strong>Admin:</strong> Product & content management<br>
                     • <strong>Store Manager:</strong> Operations & orders<br>
                     • <strong>Finance Manager:</strong> Pricing & financial data<br>
                     • <strong>Accounts:</strong> Order processing & customers<br>
                     • <strong>User:</strong> Basic access only
                   </small>
                 </div>
               </div>
             </div>
           </div>
         </div>

        <!-- Selected User Info (for edit mode) -->
        <div *ngIf="editUser" class="col-md-12 mb-3">
          <div class="form-group row clearfix">
            <div class="col-md-3">
              <label class="control-label">User:</label>
            </div>
            <div class="col-sm-8">
              <div class="form-control-plaintext">
                <strong>{{ editUser.firstName || editUser.username }}</strong>
                <small class="text-muted d-block">({{ editUser.username }})</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Save and Cancel Buttons -->
        <div class="col-md-12">
          <div class="form-group row clearfix">
            <div class="col-md-3"></div>
            <div class="col-md-8">
              <button class="btn btn-secondary me-2" 
                      type="button"
                      (click)="onCancel()"
                      [disabled]="isLoading">
                Cancel
              </button>
              <button type="button" 
                      *ngIf="!editUser" 
                      (click)="saveUserData()"
                      class="btn btn-primary btn-with-icon"
                      [disabled]="isLoading">
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin me-2"></i>
                <i *ngIf="!isLoading" class="fas fa-save me-2"></i>
                {{ isLoading ? 'Saving...' : 'Save' }}
              </button>
              <button type="button" 
                      *ngIf="editUser"
                      (click)="saveUserData()"
                      class="btn btn-primary btn-with-icon"
                      [disabled]="isLoading">
                <i *ngIf="isLoading" class="fas fa-spinner fa-spin me-2"></i>
                <i *ngIf="!isLoading" class="fas fa-edit me-2"></i>
                {{ isLoading ? 'Updating...' : 'Update' }}
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>
</div>
